'use strict'

const express = require('express')
const app = express() //this creates an instance of express
const {connect} = require('./database')
const routes = require('./routes/') //same as ./routes/index
const session = require('express-session')
const bodyParser = require('body-parser')
const RedisStore = require('connect-redis')(session)

// ****************************************************************************
// *                         this sets the view to pug                        *
// ****************************************************************************

app.set('view engine', 'pug')

// ****************************************************************************
// *                         this sets the view to pug                        *
// ****************************************************************************

// ****************************************************************************
// *                            this sets the port                            *
// ****************************************************************************

app.set('port', process.env.PORT || 3333)

// ****************************************************************************
// *                            this sets the port                            *
// ****************************************************************************

// ****************************************************************************
// *                        this sets up redis cookies                        *
// ****************************************************************************


app.use(session({
  store: new RedisStore({
    url: process.env.REDIS_URL || 'redis://localhost:6379'
  }),
  secret: 'ayeea'
}))

// ****************************************************************************
// *                        this sets up redis cookies                        *
// ****************************************************************************

// ****************************************************************************
// *                            sets up body parser                           *
// ****************************************************************************


app.use(bodyParser.urlencoded({
    extended: false
}))

// ****************************************************************************
// *                            sets up body parser                           *
// ****************************************************************************

// ****************************************************************************
// *                        looks in the public folder                        *
// ****************************************************************************

app.use(express.static('public'))

// ****************************************************************************
// *                        looks in the public folder                        *
// ****************************************************************************
 
// ****************************************************************************
// *                        accesses the routes folder                        *
// ****************************************************************************

app.use(routes)

// ****************************************************************************
// *                        accesses the routes folder                        *
// ****************************************************************************

// ****************************************************************************
// *                             connects to mongo                            *
// ****************************************************************************

connect()

// ****************************************************************************
// *                             connects to mongo                            *
// ****************************************************************************

// ****************************************************************************
// *                        listens for port connection                       *
// ****************************************************************************

.then(()=> {

    app.listen(app.get("port"), () => 
        console.log(`Express server listening on port ${app.get('port')}`)
        )
})

// ****************************************************************************
// *                        listens for port connection                       *
// ****************************************************************************

// ****************************************************************************
// *                                error catch                               *
// ****************************************************************************

.catch(console.error)

// ****************************************************************************
// *                                error catch                               *
// ****************************************************************************
